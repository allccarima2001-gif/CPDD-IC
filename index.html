<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPDD-IC</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial; background: linear-gradient(135deg, #003366 0%, #004d99 100%); min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .container { background: white; border-radius: 10px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); max-width: 900px; width: 100%; padding: 40px; }
        h1 { color: #003366; text-align: center; margin-bottom: 20px; }
        p { color: #666; margin: 15px 0; }
        .form-group { margin: 20px 0; }
        label { display: block; color: #003366; font-weight: bold; margin-bottom: 8px; }
        input, select { width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; font-size: 14px; }
        input:focus, select:focus { outline: none; border-color: #003366; }
        .radio-group { display: flex; gap: 30px; margin-top: 10px; flex-wrap: wrap; }
        button { padding: 12px 30px; background: #003366; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; transition: all 0.3s; }
        button:hover { background: #004d99; }
        .error { color: red; font-size: 12px; margin-top: 5px; }
        .hidden { display: none; }
        img { max-width: 100%; height: 400px; object-fit: contain; border-radius: 10px; border: 2px solid #003366; margin: 20px 0; }
        .progress-bar { width: 100%; height: 8px; background: #ddd; border-radius: 5px; margin-bottom: 15px; }
        .progress-fill { height: 100%; background: #003366; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 12px; }
        table th, table td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        table th { background: #003366; color: white; }
        .buttons { display: flex; gap: 10px; margin-top: 20px; }
        .buttons button { flex: 1; }

        /* ESTILOS PARA OPCIONES EN BOTONES */
        .opciones-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin: 15px 0; }
        .opcion-btn { padding: 12px; background: #f0f0f0; color: #333; border: 2px solid #ddd; border-radius: 5px; cursor: pointer; font-size: 13px; font-weight: bold; transition: all 0.3s; }
        .opcion-btn:hover { background: #e0e0e0; }
        .opcion-btn.seleccionado { background: #003366; color: white; border-color: #003366; }

        .final-mensaje { background: #e8f5e9; border: 2px solid #4caf50; border-radius: 10px; padding: 30px; text-align: center; margin: 20px 0; }
        .final-mensaje h2 { color: #2e7d32; font-size: 24px; margin-bottom: 10px; }
        .final-mensaje p { color: #558b2f; font-size: 16px; }
    </style>
</head>
<body>
    <div class="container">
        <!-- P√ÅGINA 1: INICIO -->
        <div id="inicio">
            <h1>üìã Cuestionario CPDD-IC</h1>
            <p style="text-align: center; margin: 30px 0;">Precisi√≥n Diagn√≥stica en Dermatolog√≠a</p>
            <p style="text-align: center; font-size: 14px;">Universidad Nacional Mayor de San Marcos - 2025</p>
            <div style="background: #f0f4f8; padding: 20px; border-radius: 10px; margin: 30px 0;">
                <p><strong>Instrucciones:</strong></p>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li>15 preguntas con im√°genes cl√≠nicas</li>
                    <li>Duraci√≥n: 25-30 minutos</li>
                    <li>Responde de forma individual</li>
                    <li>Selecciona el diagn√≥stico haciendo click en los botones</li>
                </ul>
            </div>
            <button onclick="abrirDemo()" style="width: 100%; padding: 15px; font-size: 16px;">Comenzar ‚Üí</button>
        </div>

        <!-- P√ÅGINA 2: DEMOGRAF√çA -->
        <div id="demo" class="hidden">
            <h1>Datos Demogr√°ficos</h1>
            <div class="form-group">
                <label>Edad:</label>
                <input type="number" id="edad" min="18" max="60">
                <div class="error" id="err-edad"></div>
            </div>
            <div class="form-group">
                <label>Sexo:</label>
                <div class="radio-group">
                    <div><input type="radio" name="sexo" value="M" id="m"><label for="m" style="display:inline;margin:0;">Masculino</label></div>
                    <div><input type="radio" name="sexo" value="F" id="f"><label for="f" style="display:inline;margin:0;">Femenino</label></div>
                </div>
                <div class="error" id="err-sexo"></div>
            </div>
            <div class="form-group">
                <label>Instituci√≥n:</label>
                <select id="inst">
                    <option value="">-- Selecciona --</option>
                    <option value="MINSA">MINSA</option>
                    <option value="EsSalud">EsSalud</option>
                    <option value="FFAA">Fuerzas Armadas</option>
                    <option value="Privadas">Cl√≠nicas Privadas</option>
                </select>
                <div class="error" id="err-inst"></div>
            </div>
            <button onclick="validarDemo()" style="width: 100%; padding: 15px;">Siguiente ‚Üí</button>
        </div>

        <!-- P√ÅGINA 3: PREGUNTAS -->
        <div id="preguntas" class="hidden"></div>

        <!-- P√ÅGINA 4: RESULTADOS -->
        <div id="resultados" class="hidden">
            <h1>üìä Resultados</h1>
            <div id="contenido-resultados"></div>
        </div>
    </div>

    <script>
        const URL_SCRIPT = "https://script.google.com/macros/s/AKfycbxIaE-VKXXdLpnkKxa2fZoivpAq9jQSuxHFS0_8XohKnHZsHRv5zWqTfBsabo9VL8oh/exec";
        
        const PREGUNTAS = [
            {num: 1, correcto: "Dermatitis de contacto al√©rgica", img: "Dermatitis de contacto.jpg"},
            {num: 2, correcto: "Dermatitis at√≥pica", img: "Dermatitis at√≥pica.jpg"},
            {num: 3, correcto: "Queratosis seborreica", img: "Queratosis seborreica.jpg"},
            {num: 4, correcto: "Imp√©tigo no bulloso", img: "Imp√©tigo.jpg"},
            {num: 5, correcto: "Psoriasis", img: "Psoriasis.jpg"},
            {num: 6, correcto: "Melanoma", img: "Melanoma.jpg"},
            {num: 7, correcto: "Acn√© vulgar", img: "Acn√©.jpg"},
            {num: 8, correcto: "Verruga vulgar", img: "Verruga vulgar.jpg"},
            {num: 9, correcto: "Ros√°cea", img: "Ros√°cea.jpg"},
            {num: 10, correcto: "Ti√±a corporis", img: "Ti√±a corporis.jpg"},
            {num: 11, correcto: "Carcinoma basocelular", img: "Carcinoma basocelular.jpg"},
            {num: 12, correcto: "Nevo melanoc√≠tico com√∫n", img: "Nevus.jpg"},
            {num: 13, correcto: "Lentigo solar", img: "Lentigo solar.jpg"},
            {num: 14, correcto: "Queratosis act√≠nica", img: "Queratosis act√≠nica.jpg"},
            {num: 15, correcto: "Molusco contagioso", img: "Molusco contagioso.jpg"}
        ];

        const OPCIONES = ["Acn√© vulgar","Carcinoma basocelular","Dermatitis at√≥pica","Dermatitis de contacto al√©rgica","Imp√©tigo no bulloso","Lentigo solar","Melanoma","Molusco contagioso","Nevo melanoc√≠tico com√∫n","Psoriasis","Queratosis act√≠nica","Queratosis seborreica","Ros√°cea","Ti√±a corporis","Verruga vulgar"];

        let datos = {};
        let enviado = false;

        function limpiar() {
            document.getElementById('inicio').classList.add('hidden');
            document.getElementById('demo').classList.add('hidden');
            document.getElementById('preguntas').classList.add('hidden');
            document.getElementById('resultados').classList.add('hidden');
        }

        function abrirDemo() {
            limpiar();
            document.getElementById('demo').classList.remove('hidden');
        }

        function validarDemo() {
            const edad = document.getElementById('edad').value;
            const sexo = document.querySelector('input[name="sexo"]:checked');
            const inst = document.getElementById('inst').value;

            document.getElementById('err-edad').textContent = '';
            document.getElementById('err-sexo').textContent = '';
            document.getElementById('err-inst').textContent = '';

            if(!edad || edad < 18 || edad > 60) {
                document.getElementById('err-edad').textContent = 'Edad inv√°lida';
                return;
            }
            if(!sexo) {
                document.getElementById('err-sexo').textContent = 'Selecciona sexo';
                return;
            }
            if(!inst) {
                document.getElementById('err-inst').textContent = 'Selecciona instituci√≥n';
                return;
            }

            datos = {
                edad: edad,
                sexo: sexo.value,
                inst: inst,
                r: {}
            };

            mostrarPreguntas();
        }

        function mostrarPreguntas() {
            limpiar();
            const div = document.getElementById('preguntas');
            div.innerHTML = '';
            div.classList.remove('hidden');

            PREGUNTAS.forEach(p => {
                const sec = document.createElement('div');
                sec.id = 'p' + p.num;
                sec.style.display = 'none';
                sec.innerHTML = `
                    <div class="progress-bar"><div class="progress-fill" style="width:${p.num*100/15}%"></div></div>
                    <h2>Pregunta ${p.num}/15</h2>
                    <img src="${p.img}" alt="P${p.num}">
                    <div class="form-group">
                        <label>Selecciona el diagn√≥stico:</label>
                        <div class="opciones-grid" id="opciones${p.num}">
                            ${OPCIONES.map(o => `<button type="button" class="opcion-btn" onclick="seleccionar(${p.num}, '${o}')">${o}</button>`).join('')}
                        </div>
                    </div>
                    <div class="buttons">
                        ${p.num > 1 ? `<button onclick="mostrarP(${p.num-1})">‚Üê Anterior</button>` : '<div></div>'}
                        <button onclick="responder(${p.num})">${p.num === 15 ? 'Finalizar' : 'Siguiente ‚Üí'}</button>
                    </div>
                `;
                div.appendChild(sec);
            });

            mostrarP(1);
        }

        function seleccionar(numP, opcion) {
            // Remover selecci√≥n anterior
            document.querySelectorAll('#opciones' + numP + ' .opcion-btn').forEach(btn => {
                btn.classList.remove('seleccionado');
            });
            
            // Seleccionar la nueva
            event.target.classList.add('seleccionado');
            datos.r[numP] = opcion;
        }

        function mostrarP(n) {
            document.querySelectorAll('#preguntas > div').forEach(d => d.style.display = 'none');
            document.getElementById('p' + n).style.display = 'block';
            
            // Restaurar bot√≥n seleccionado si ya hay respuesta
            if(datos.r[n]) {
                document.querySelectorAll('#opciones' + n + ' .opcion-btn').forEach(btn => {
                    if(btn.textContent === datos.r[n]) {
                        btn.classList.add('seleccionado');
                    }
                });
            }
            
            window.scrollTo(0, 0);
        }

        function responder(n) {
            if(!datos.r[n]) {
                alert('Selecciona un diagn√≥stico');
                return;
            }
            if(n === 15) finalizarCuestionario();
            else mostrarP(n + 1);
        }

        function finalizarCuestionario() {
            let correctas = 0;
            PREGUNTAS.forEach(p => {
                if(datos.r[p.num] === p.correcto) correctas++;
            });
            datos.precision = Math.round(correctas * 100 / 15);

            let tabla = '<table><tr><th>P</th><th>Tu respuesta</th><th>Correcta</th><th>R</th></tr>';
            PREGUNTAS.forEach(p => {
                const ok = datos.r[p.num] === p.correcto;
                tabla += `<tr><td>P${p.num}</td><td>${datos.r[p.num]}</td><td>${p.correcto}</td><td style="color:${ok?'green':'red'}">${ok?'‚úì':'‚úó'}</td></tr>`;
            });
            tabla += '</table>';

            limpiar();
            const div = document.getElementById('resultados');
            div.classList.remove('hidden');
            div.innerHTML = `
                <div style="background: #f0f4f8; padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <p><strong>Respuestas correctas:</strong> ${correctas}/15</p>
                    <p><strong>Respuestas incorrectas:</strong> ${15-correctas}/15</p>
                    <p style="font-size: 24px; color: #003366;"><strong>Precisi√≥n: ${datos.precision}%</strong></p>
                </div>
                <h3 style="color: #003366; margin-bottom: 10px;">Detalle de respuestas:</h3>
                ${tabla}
                <button id="btnEnviar" onclick="enviar()" style="margin-top: 20px; width: 100%; padding: 15px; font-size: 16px;">üì§ Enviar a Google Sheets</button>
                <div id="mensajeFinal" class="hidden"></div>
            `;
            window.scrollTo(0, 0);
        }

        function enviar() {
            if(enviado) return;
            
            document.getElementById('btnEnviar').disabled = true;
            document.getElementById('btnEnviar').style.opacity = '0.5';
            document.getElementById('btnEnviar').style.cursor = 'not-allowed';

            fetch(URL_SCRIPT, {
                method: 'POST',
                body: JSON.stringify(datos)
            })
            .then(r => r.json())
            .then(res => {
                enviado = true;
                document.getElementById('btnEnviar').style.display = 'none';
                document.getElementById('mensajeFinal').innerHTML = `
                    <div class="final-mensaje">
                        <h2>‚úì ¬°Gracias!</h2>
                        <p>Tu cuestionario ha sido enviado exitosamente.</p>
                        <p style="font-size: 14px; margin-top: 10px;">Tus respuestas han sido registradas en nuestra base de datos.</p>
                    </div>
                `;
                document.getElementById('mensajeFinal').classList.remove('hidden');
            })
            .catch(e => {
                alert('Error al enviar: ' + e.message);
                document.getElementById('btnEnviar').disabled = false;
                document.getElementById('btnEnviar').style.opacity = '1';
                document.getElementById('btnEnviar').style.cursor = 'pointer';
            });
        }
    </script>
</body>
</html>
